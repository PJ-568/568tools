<!doctype html><html lang=zh-CN class="sidebar-visible no-js light"><meta charset=UTF-8><title>使用.tar包 - Rusty Book(锈书)</title><meta content="text/html; charset=utf-8" http-equiv=Content-Type><meta name=description content=""><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content=#ffffff><link rel=icon href=../../favicon.svg><link rel="shortcut icon" href=../../favicon.png><link rel=stylesheet href=../../css/variables.css><link rel=stylesheet href=../../css/general.css><link rel=stylesheet href=../../css/chrome.css><link rel=stylesheet href=../../css/print.css media=print><link rel=stylesheet href=../../FontAwesome/css/font-awesome.css><link rel=stylesheet href=../../fonts/fonts.css><link rel=stylesheet href=../../highlight.css><link rel=stylesheet href=../../tomorrow-night.css><link rel=stylesheet href=../../ayu-highlight.css><link rel=stylesheet href=../../theme/style1.css><body><script>var path_to_root="../../",default_theme=window.matchMedia("(prefers-color-scheme: dark)").matches?"navy":"light"</script><script>try{var theme=localStorage.getItem("mdbook-theme"),sidebar=localStorage.getItem("mdbook-sidebar");theme.startsWith('"')&&theme.endsWith('"')&&localStorage.setItem("mdbook-theme",theme.slice(1,theme.length-1)),sidebar.startsWith('"')&&sidebar.endsWith('"')&&localStorage.setItem("mdbook-sidebar",sidebar.slice(1,sidebar.length-1))}catch(e){}</script><script>var theme;try{theme=localStorage.getItem("mdbook-theme")}catch(e){}null==theme&&(theme=default_theme);var html=document.querySelector("html");html.classList.remove("no-js"),html.classList.remove("light"),html.classList.add(theme),html.classList.add("js")</script><script>var html=document.querySelector("html"),sidebar="hidden";if(document.body.clientWidth>=1080){try{sidebar=localStorage.getItem("mdbook-sidebar")}catch(e){}sidebar=sidebar||"visible"}html.classList.remove("sidebar-visible"),html.classList.add("sidebar-"+sidebar)</script><nav id=sidebar class=sidebar aria-label="Table of contents"><div class=sidebar-scrollbox><ol class=chapter><li class="chapter-item expanded affix"><a href=../../about.html>Rusty Book</a><li class="chapter-item expanded affix"><li class=part-title>Awesome<li class=spacer><li class="chapter-item expanded"><a href=../../daily-dev.html>日常开发常用库</a><li class="chapter-item expanded"><a href=../../superstar.html>Rust 明星项目</a><li class="chapter-item expanded"><a href=../../empowering-js.html>使用 Rust 增强 JS</a><li class="chapter-item expanded"><a href=../../games.html>Rust开发的游戏</a><li class="chapter-item expanded"><a href=../../gamedev.html>游戏引擎</a><li class="chapter-item expanded affix"><li class=part-title>Awesome + Cookbook<li class=spacer><li class="chapter-item expanded"><a href=../../algos/awesome.html>实用算法</a><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../algos/randomness.html>生成随机值</a><li class="chapter-item expanded"><a href=../../algos/sorting.html>Vec 排序</a><li class="chapter-item expanded"><div>压缩算法</div><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../algos/compression/tar.html class=active>使用.tar包</a></ol><li class="chapter-item expanded"><div>密码学</div><a class=toggle><div>❱</div></a><li><ol class=section><li class=chapter-item><a href=../../algos/cryptography/hashing.html>哈希</a><li class=chapter-item><a href=../../algos/cryptography/encryption.html>加密</a></ol><li class="chapter-item expanded"><div>数学计算</div><a class=toggle><div>❱</div></a><li><ol class=section><li class=chapter-item><a href=../../algos/math/linear-algebra.html>线性代数</a><li class=chapter-item><a href=../../algos/math/trigonometry.html>三角函数</a><li class=chapter-item><a href=../../algos/math/complex.html>复数</a><li class=chapter-item><a href=../../algos/math/statistics.html>统计学</a><li class=chapter-item><a href=../../algos/math/misc.html>杂项</a></ol></ol><li class="chapter-item expanded"><a href=../../datastructures/awesome.html>数据结构</a><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../datastructures/bitfield.html>位字段</a></ol><li class="chapter-item expanded"><a href=../../cmd/awesome.html>命令行</a><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../cmd/parsing.html>参数解析</a><li class="chapter-item expanded"><a href=../../cmd/ansi.html>终端输出格式化</a></ol><li class="chapter-item expanded"><a href=../../os/awesome.html>操作系统</a><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../os/processor.html>处理器</a><li class="chapter-item expanded"><a href=../../os/command.html>调用系统命令</a></ol><li class="chapter-item expanded"><div>并发</div><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../cocurrency/threads.html>线程</a><li class="chapter-item expanded"><a href=../../cocurrency/parallel.html>使用rayon并行处理数据</a></ol><li class="chapter-item expanded"><div>数据库</div><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../database/sqlite.html>SQLite</a><li class="chapter-item expanded"><a href=../../database/postgres.html>Postgres</a></ol><li class="chapter-item expanded"><div>日期和时间</div><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../datetime/duration.html>时间计算和转换</a><li class="chapter-item expanded"><a href=../../datetime/parsing.html>解析和显示</a></ol><li class="chapter-item expanded"><div>开发者工具</div><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../devtools/log.html>日志</a><li class="chapter-item expanded"><a href=../../devtools/config-log.html>配置日志</a><li class="chapter-item expanded"><a href=../../devtools/version.html>版本号</a><li class="chapter-item expanded"><a href=../../devtools/build-tools.html>构建时工具</a></ol><li class="chapter-item expanded"><div>编解码</div><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../encoding/strings.html>字符编码</a><li class="chapter-item expanded"><a href=../../encoding/csv.html>CSV</a><li class="chapter-item expanded"><a href=../../encoding/structured.html>结构化数据</a></ol><li class="chapter-item expanded"><div>错误处理</div><li class="chapter-item expanded"><div>文件操作</div><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../files/read-write.html>文件读写</a><li class="chapter-item expanded"><a href=../../files/dir.html>目录访问</a></ol><li class="chapter-item expanded"><div>内存管理</div><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../memory/global-vars.html>全局变量</a></ol><li class="chapter-item expanded"><div>网络协议</div><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../protocols/tcpip.html>TCP/IP</a></ol><li class="chapter-item expanded"><div>文本处理</div><a class=toggle><div>❱</div></a><li><ol class=section><li class="chapter-item expanded"><a href=../../text/regex.html>正则表达式</a><li class="chapter-item expanded"><a href=../../text/string.html>字符串解析</a></ol></ol></div><div id=sidebar-resize-handle class=sidebar-resize-handle></div></nav><div id=page-wrapper class=page-wrapper><div class=page><div id=menu-bar-hover-placeholder></div><div id=menu-bar class="menu-bar sticky bordered"><div class=left-buttons><button id=sidebar-toggle class=icon-button type=button title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls=sidebar><i class="fa fa-bars"></i></button> <button id=theme-toggle class=icon-button type=button title="Change theme" aria-label="Change theme" aria-haspopup=true aria-expanded=false aria-controls=theme-list><i class="fa fa-paint-brush"></i></button><ul id=theme-list class=theme-popup aria-label=Themes role=menu><li role=none><button role=menuitem class=theme id=light>Light (default)</button><li role=none><button role=menuitem class=theme id=rust>Rust</button><li role=none><button role=menuitem class=theme id=coal>Coal</button><li role=none><button role=menuitem class=theme id=navy>Navy</button><li role=none><button role=menuitem class=theme id=ayu>Ayu</button></ul><button id=search-toggle class=icon-button type=button title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded=false aria-keyshortcuts=S aria-controls=searchbar><i class="fa fa-search"></i></button></div><h1 class=menu-title>Rusty Book(锈书)</h1><div class=right-buttons><a href=../../print.html title="Print this book" aria-label="Print this book"><i id=print-button class="fa fa-print"></i> </a><a href=https://github.com/studyrs/rusty-book title="Git repository" aria-label="Git repository"><i id=git-repository-button class="fa fa-github"></i> </a><a href=https://github.com/studyrs/rusty-book/edit/main/src/algos/compression/tar.md title="Suggest an edit" aria-label="Suggest an edit"><i id=git-edit-button class="fa fa-edit"></i></a></div></div><div id=search-wrapper class=hidden><form id=searchbar-outer class=searchbar-outer><input type=search id=searchbar name=searchbar placeholder="Search this book ..." aria-controls=searchresults-outer aria-describedby=searchresults-header></form><div id=searchresults-outer class="searchresults-outer hidden"><div id=searchresults-header class=searchresults-header></div><ul id=searchresults></ul></div></div><script>document.getElementById("sidebar-toggle").setAttribute("aria-expanded","visible"===sidebar),document.getElementById("sidebar").setAttribute("aria-hidden","visible"!==sidebar),Array.from(document.querySelectorAll("#sidebar a")).forEach((function(e){e.setAttribute("tabIndex","visible"===sidebar?0:-1)}))</script><div id=content class=content><div class=sidetoc><nav class=pagetoc></nav></div><main><h1 id=使用tar包><a class=header href=#使用tar包>使用tar包</a></h1><h2 id=解压-tar-包><a class=header href=#解压-tar-包>解压 tar 包</a></h2><p>以下代码将解压缩( <a href=https://docs.rs/flate2/*/flate2/read/struct.GzDecoder.html>GzDecoder</a> )当前目录中的 <code>archive.tar.gz</code> ，并将所有文件抽取出( <a href=https://docs.rs/tar/*/tar/struct.Archive.html#method.unpack>Archive::unpack</a> )来后当入到当前目录中。<pre><pre class=playground><code class="language-rust editable edition2021">use std::fs::File;
use flate2::read::GzDecoder;
use tar::Archive;

fn main() -&gt; Result&lt;(), std::io::Error&gt; {
    let path = &quot;archive.tar.gz&quot;;

    let tar_gz = File::open(path)?;
    let tar = GzDecoder::new(tar_gz);
    let mut archive = Archive::new(tar);
    archive.unpack(&quot;.&quot;)?;

    Ok(())
}
</code></pre></pre><h2 id=将目录压缩成-tar-包><a class=header href=#将目录压缩成-tar-包>将目录压缩成 tar 包</a></h2><p>以下代码将 <code>/var/log</code> 目录压缩成 <code>archive.tar.gz</code>:<ul><li>创建一个 <a href=https://doc.rust-lang.org/std/fs/struct.File.html>File</a> 文件，并使用 <a href=https://docs.rs/flate2/*/flate2/write/struct.GzEncoder.html>GzEncoder</a> 和 <a href=https://docs.rs/tar/*/tar/struct.Builder.html>tar::Builder</a> 对其进行包裹<li>通过 <a href=https://docs.rs/tar/*/tar/struct.Builder.html#method.append_dir_all>Builder::append_dir_all</a> 将 <code>/var/log</code> 目录下的所有内容添加到压缩文件中，该文件在 <code>backup/logs</code> 目录下。<li><a href=https://docs.rs/flate2/*/flate2/write/struct.GzEncoder.html>GzEncoder</a> 负责在写入压缩文件 <code>archive.tar.gz</code> 之前对数据进行压缩。</ul><pre><pre class=playground><code class="language-rust editable edition2021">use std::fs::File;
use flate2::Compression;
use flate2::write::GzEncoder;

fn main() -&gt; Result&lt;(), std::io::Error&gt; {
    let tar_gz = File::create(&quot;archive.tar.gz&quot;)?;
    let enc = GzEncoder::new(tar_gz, Compression::default());
    let mut tar = tar::Builder::new(enc);
    tar.append_dir_all(&quot;backup/logs&quot;, &quot;/var/log&quot;)?;
    Ok(())
}
</code></pre></pre><h2 id=解压的同时删除指定的文件前缀><a class=header href=#解压的同时删除指定的文件前缀>解压的同时删除指定的文件前缀</a></h2><p>遍历目录中的文件 <a href=https://docs.rs/tar/*/tar/struct.Archive.html#method.entries>Archive::entries</a>，若解压前的文件名包含 <code>bundle/logs</code> 前缀，需要将前缀从文件名移除( <a href=https://doc.rust-lang.org/std/path/struct.Path.html#method.strip_prefix>Path::strip_prefix</a> )后，再解压。<pre><pre class=playground><code class="language-rust editable edition2021">use std::fs::File;
use std::path::PathBuf;
use flate2::read::GzDecoder;
use tar::Archive;

fn main() -&gt; Result&lt;()&gt; {
    let file = File::open(&quot;archive.tar.gz&quot;)?;
    let mut archive = Archive::new(GzDecoder::new(file));
    let prefix = &quot;bundle/logs&quot;;

    println!(&quot;Extracted the following files:&quot;);
    archive
        .entries()? // 获取压缩档案中的文件条目列表
        .filter_map(|e| e.ok())
        // 对每个文件条目进行 map 处理
        .map(|mut entry| -&gt; Result&lt;PathBuf&gt; {
            // 将文件路径名中的前缀移除，获取一个新的路径名
            let path = entry.path()?.strip_prefix(prefix)?.to_owned();
            // 将内容解压到新的路径名中
            entry.unpack(&amp;path)?;
            Ok(path)
        })
        .filter_map(|e| e.ok())
        .for_each(|x| println!(&quot;&gt; {}&quot;, x.display()));

    Ok(())
}
</code></pre></pre><div id=giscus-container></div></main><nav class=nav-wrapper aria-label="Page navigation"><a rel=prev href=../../algos/sorting.html class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts=Left><i class="fa fa-angle-left"></i> </a><a rel=next href=../../algos/cryptography/hashing.html class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts=Right><i class="fa fa-angle-right"></i></a><div style=clear:both></div></nav></div></div><nav class=nav-wide-wrapper aria-label="Page navigation"><a rel=prev href=../../algos/sorting.html class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts=Left><i class="fa fa-angle-left"></i> </a><a rel=next href=../../algos/cryptography/hashing.html class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts=Right><i class="fa fa-angle-right"></i></a></nav></div><script>window.playground_copyable=!0</script><script src=../../ace.js charset=utf-8></script><script src=../../editor.js charset=utf-8></script><script src=../../mode-rust.js charset=utf-8></script><script src=../../theme-dawn.js charset=utf-8></script><script src=../../theme-tomorrow_night.js charset=utf-8></script><script src=../../elasticlunr.min.js charset=utf-8></script><script src=../../mark.min.js charset=utf-8></script><script src=../../searcher.js charset=utf-8></script><script src=../../clipboard.min.js charset=utf-8></script><script src=../../highlight.js charset=utf-8></script><script src=../../book.js charset=utf-8></script><script>var pagePath="algos/compression/tar.md"</script><script src=../../assets/custom1.js></script><script src=../../assets/bigPicture.js></script>
