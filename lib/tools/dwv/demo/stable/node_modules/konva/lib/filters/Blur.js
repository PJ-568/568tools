import{Factory}from"../Factory.js";import{Node}from"../Node.js";import{getNumberValidator}from"../Validators.js";function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function filterGaussBlurRGBA(r,t){var a,e,o,l,n,u,i,b,s,f,g,d,h,x,c,m,B,F,G,N,S,p,y,R,_=r.data,j=r.width,k=r.height,v=t+t+1,w=j-1,V=k-1,A=t+1,M=A*(A+1)/2,q=new BlurStack,z=null,C=q,D=null,E=null,H=mul_table[t],I=shg_table[t];for(o=1;o<v;o++)C=C.next=new BlurStack,o===A&&(z=C);for(C.next=q,i=u=0,e=0;e<k;e++){for(m=B=F=G=b=s=f=g=0,d=A*(N=_[u]),h=A*(S=_[u+1]),x=A*(p=_[u+2]),c=A*(y=_[u+3]),b+=M*N,s+=M*S,f+=M*p,g+=M*y,C=q,o=0;o<A;o++)C.r=N,C.g=S,C.b=p,C.a=y,C=C.next;for(o=1;o<A;o++)l=u+((w<o?w:o)<<2),b+=(C.r=N=_[l])*(R=A-o),s+=(C.g=S=_[l+1])*R,f+=(C.b=p=_[l+2])*R,g+=(C.a=y=_[l+3])*R,m+=N,B+=S,F+=p,G+=y,C=C.next;for(D=q,E=z,a=0;a<j;a++)_[u+3]=y=g*H>>I,0!==y?(y=255/y,_[u]=(b*H>>I)*y,_[u+1]=(s*H>>I)*y,_[u+2]=(f*H>>I)*y):_[u]=_[u+1]=_[u+2]=0,b-=d,s-=h,f-=x,g-=c,d-=D.r,h-=D.g,x-=D.b,c-=D.a,l=i+((l=a+t+1)<w?l:w)<<2,b+=m+=D.r=_[l],s+=B+=D.g=_[l+1],f+=F+=D.b=_[l+2],g+=G+=D.a=_[l+3],D=D.next,d+=N=E.r,h+=S=E.g,x+=p=E.b,c+=y=E.a,m-=N,B-=S,F-=p,G-=y,E=E.next,u+=4;i+=j}for(a=0;a<j;a++){for(B=F=G=m=s=f=g=b=0,d=A*(N=_[u=a<<2]),h=A*(S=_[u+1]),x=A*(p=_[u+2]),c=A*(y=_[u+3]),b+=M*N,s+=M*S,f+=M*p,g+=M*y,C=q,o=0;o<A;o++)C.r=N,C.g=S,C.b=p,C.a=y,C=C.next;for(n=j,o=1;o<=t;o++)u=n+a<<2,b+=(C.r=N=_[u])*(R=A-o),s+=(C.g=S=_[u+1])*R,f+=(C.b=p=_[u+2])*R,g+=(C.a=y=_[u+3])*R,m+=N,B+=S,F+=p,G+=y,C=C.next,o<V&&(n+=j);for(u=a,D=q,E=z,e=0;e<k;e++)_[(l=u<<2)+3]=y=g*H>>I,y>0?(y=255/y,_[l]=(b*H>>I)*y,_[l+1]=(s*H>>I)*y,_[l+2]=(f*H>>I)*y):_[l]=_[l+1]=_[l+2]=0,b-=d,s-=h,f-=x,g-=c,d-=D.r,h-=D.g,x-=D.b,c-=D.a,l=a+((l=e+A)<V?l:V)*j<<2,b+=m+=D.r=_[l],s+=B+=D.g=_[l+1],f+=F+=D.b=_[l+2],g+=G+=D.a=_[l+3],D=D.next,d+=N=E.r,h+=S=E.g,x+=p=E.b,c+=y=E.a,m-=N,B-=S,F-=p,G-=y,E=E.next,u+=j}}export const Blur=function(r){var t=Math.round(this.blurRadius());t>0&&filterGaussBlurRGBA(r,t)};Factory.addGetterSetter(Node,"blurRadius",0,getNumberValidator(),Factory.afterSetFilter);
