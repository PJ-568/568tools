import{Factory}from"../Factory.js";import{Line}from"./Line.js";import{getNumberValidator}from"../Validators.js";import{_registerNode}from"../Global.js";import{Path}from"./Path.js";export class Arrow extends Line{_sceneFunc(t){super._sceneFunc(t);var e=2*Math.PI,r=this.points(),i=r,o=0!==this.tension()&&r.length>4;o&&(i=this.getTensionPoints());var n,a,s=this.pointerLength(),h=r.length;if(o){const t=[i[i.length-4],i[i.length-3],i[i.length-2],i[i.length-1],r[h-2],r[h-1]],e=Path.calcLength(i[i.length-4],i[i.length-3],"C",t),o=Path.getPointOnQuadraticBezier(Math.min(1,1-s/e),t[0],t[1],t[2],t[3],t[4],t[5]);n=r[h-2]-o.x,a=r[h-1]-o.y}else n=r[h-2]-r[h-4],a=r[h-1]-r[h-3];var l=(Math.atan2(a,n)+e)%e,g=this.pointerWidth();this.pointerAtEnding()&&(t.save(),t.beginPath(),t.translate(r[h-2],r[h-1]),t.rotate(l),t.moveTo(0,0),t.lineTo(-s,g/2),t.lineTo(-s,-g/2),t.closePath(),t.restore(),this.__fillStroke(t)),this.pointerAtBeginning()&&(t.save(),t.beginPath(),t.translate(r[0],r[1]),o?(n=(i[0]+i[2])/2-r[0],a=(i[1]+i[3])/2-r[1]):(n=r[2]-r[0],a=r[3]-r[1]),t.rotate((Math.atan2(-a,-n)+e)%e),t.moveTo(0,0),t.lineTo(-s,g/2),t.lineTo(-s,-g/2),t.closePath(),t.restore(),this.__fillStroke(t))}__fillStroke(t){var e=this.dashEnabled();e&&(this.attrs.dashEnabled=!1,t.setLineDash([])),t.fillStrokeShape(this),e&&(this.attrs.dashEnabled=!0)}getSelfRect(){const t=super.getSelfRect(),e=this.pointerWidth()/2;return{x:t.x-e,y:t.y-e,width:t.width+2*e,height:t.height+2*e}}}Arrow.prototype.className="Arrow",_registerNode(Arrow),Factory.addGetterSetter(Arrow,"pointerLength",10,getNumberValidator()),Factory.addGetterSetter(Arrow,"pointerWidth",10,getNumberValidator()),Factory.addGetterSetter(Arrow,"pointerAtBeginning",!1),Factory.addGetterSetter(Arrow,"pointerAtEnding",!0);
