import{Util}from"./Util.js";import{SceneContext,HitContext}from"./Context.js";import{Konva}from"./Global.js";import{Factory}from"./Factory.js";import{getNumberValidator}from"./Validators.js";var _pixelRatio;function getDevicePixelRatio(){if(_pixelRatio)return _pixelRatio;var t=Util.createCanvasElement(),i=t.getContext("2d");return _pixelRatio=(Konva._global.devicePixelRatio||1)/(i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1),Util.releaseCanvas(t),_pixelRatio}export class Canvas{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var i=(t||{}).pixelRatio||Konva.pixelRatio||getDevicePixelRatio();this.pixelRatio=i,this._canvas=Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){var i=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/i,this.getHeight()/i)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var i=this.pixelRatio;this.getContext()._context.scale(i,i)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var i=this.pixelRatio;this.getContext()._context.scale(i,i)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,i){this.setWidth(t||0),this.setHeight(i||0)}toDataURL(t,i){try{return this._canvas.toDataURL(t,i)}catch(t){try{return this._canvas.toDataURL()}catch(t){return Util.error("Unable to get data URL. "+t.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}Factory.addGetterSetter(Canvas,"pixelRatio",void 0,getNumberValidator());export class SceneCanvas extends Canvas{constructor(t={width:0,height:0}){super(t),this.context=new SceneContext(this),this.setSize(t.width,t.height)}}export class HitCanvas extends Canvas{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new HitContext(this),this.setSize(t.width,t.height)}}
