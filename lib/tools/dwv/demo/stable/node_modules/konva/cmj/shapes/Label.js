"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tag=exports.Label=void 0;const Factory_1=require("../Factory"),Shape_1=require("../Shape"),Group_1=require("../Group"),Validators_1=require("../Validators"),Global_1=require("../Global");var ATTR_CHANGE_LIST=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],CHANGE_KONVA="Change.konva",NONE="none",UP="up",RIGHT="right",DOWN="down",LEFT="left",attrChangeListLen=ATTR_CHANGE_LIST.length;class Label extends Group_1.Group{constructor(t){super(t),this.on("add.konva",(function(t){this._addListeners(t.child),this._sync()}))}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(t){var e,i=this,r=function(){i._sync()};for(e=0;e<attrChangeListLen;e++)t.on(ATTR_CHANGE_LIST[e]+CHANGE_KONVA,r)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){var t,e,i,r,a,o,n,h=this.getText(),s=this.getTag();if(h&&s){switch(t=h.width(),e=h.height(),i=s.pointerDirection(),r=s.pointerWidth(),n=s.pointerHeight(),a=0,o=0,i){case UP:a=t/2,o=-1*n;break;case RIGHT:a=t+r,o=e/2;break;case DOWN:a=t/2,o=e+n;break;case LEFT:a=-1*r,o=e/2}s.setAttrs({x:-1*a,y:-1*o,width:t,height:e}),h.setAttrs({x:-1*a,y:-1*o})}}}exports.Label=Label,Label.prototype.className="Label",(0,Global_1._registerNode)(Label);class Tag extends Shape_1.Shape{_sceneFunc(t){var e=this.width(),i=this.height(),r=this.pointerDirection(),a=this.pointerWidth(),o=this.pointerHeight(),n=this.cornerRadius();let h=0,s=0,l=0,T=0;"number"==typeof n?h=s=l=T=Math.min(n,e/2,i/2):(h=Math.min(n[0]||0,e/2,i/2),s=Math.min(n[1]||0,e/2,i/2),T=Math.min(n[2]||0,e/2,i/2),l=Math.min(n[3]||0,e/2,i/2)),t.beginPath(),t.moveTo(h,0),r===UP&&(t.lineTo((e-a)/2,0),t.lineTo(e/2,-1*o),t.lineTo((e+a)/2,0)),t.lineTo(e-s,0),t.arc(e-s,s,s,3*Math.PI/2,0,!1),r===RIGHT&&(t.lineTo(e,(i-o)/2),t.lineTo(e+a,i/2),t.lineTo(e,(i+o)/2)),t.lineTo(e,i-T),t.arc(e-T,i-T,T,0,Math.PI/2,!1),r===DOWN&&(t.lineTo((e+a)/2,i),t.lineTo(e/2,i+o),t.lineTo((e-a)/2,i)),t.lineTo(l,i),t.arc(l,i-l,l,Math.PI/2,Math.PI,!1),r===LEFT&&(t.lineTo(0,(i+o)/2),t.lineTo(-1*a,i/2),t.lineTo(0,(i-o)/2)),t.lineTo(0,h),t.arc(h,h,h,Math.PI,3*Math.PI/2,!1),t.closePath(),t.fillStrokeShape(this)}getSelfRect(){var t=0,e=0,i=this.pointerWidth(),r=this.pointerHeight(),a=this.pointerDirection(),o=this.width(),n=this.height();return a===UP?(e-=r,n+=r):a===DOWN?n+=r:a===LEFT?(t-=1.5*i,o+=i):a===RIGHT&&(o+=1.5*i),{x:t,y:e,width:o,height:n}}}exports.Tag=Tag,Tag.prototype.className="Tag",(0,Global_1._registerNode)(Tag),Factory_1.Factory.addGetterSetter(Tag,"pointerDirection",NONE),Factory_1.Factory.addGetterSetter(Tag,"pointerWidth",0,(0,Validators_1.getNumberValidator)()),Factory_1.Factory.addGetterSetter(Tag,"pointerHeight",0,(0,Validators_1.getNumberValidator)()),Factory_1.Factory.addGetterSetter(Tag,"cornerRadius",0,(0,Validators_1.getNumberOrArrayOfNumbersValidator)(4));
