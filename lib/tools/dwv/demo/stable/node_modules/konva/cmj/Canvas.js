"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HitCanvas=exports.SceneCanvas=exports.Canvas=void 0;const Util_1=require("./Util"),Context_1=require("./Context"),Global_1=require("./Global"),Factory_1=require("./Factory"),Validators_1=require("./Validators");var _pixelRatio;function getDevicePixelRatio(){if(_pixelRatio)return _pixelRatio;var t=Util_1.Util.createCanvasElement(),e=t.getContext("2d");return _pixelRatio=(Global_1.Konva._global.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),Util_1.Util.releaseCanvas(t),_pixelRatio}class Canvas{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var e=(t||{}).pixelRatio||Global_1.Konva.pixelRatio||getDevicePixelRatio();this.pixelRatio=e,this._canvas=Util_1.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){var e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch(t){try{return this._canvas.toDataURL()}catch(t){return Util_1.Util.error("Unable to get data URL. "+t.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}exports.Canvas=Canvas,Factory_1.Factory.addGetterSetter(Canvas,"pixelRatio",void 0,(0,Validators_1.getNumberValidator)());class SceneCanvas extends Canvas{constructor(t={width:0,height:0}){super(t),this.context=new Context_1.SceneContext(this),this.setSize(t.width,t.height)}}exports.SceneCanvas=SceneCanvas;class HitCanvas extends Canvas{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new Context_1.HitContext(this),this.setSize(t.width,t.height)}}exports.HitCanvas=HitCanvas;
