"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Sprite=void 0;const Factory_1=require("../Factory"),Shape_1=require("../Shape"),Animation_1=require("../Animation"),Validators_1=require("../Validators"),Global_1=require("../Global");class Sprite extends Shape_1.Shape{constructor(t){super(t),this._updated=!0,this.anim=new Animation_1.Animation((()=>{var t=this._updated;return this._updated=!1,t})),this.on("animationChange.konva",(function(){this.frameIndex(0)})),this.on("frameIndexChange.konva",(function(){this._updated=!0})),this.on("frameRateChange.konva",(function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())}))}_sceneFunc(t){var e=this.animation(),a=this.frameIndex(),i=4*a,r=this.animations()[e],n=this.frameOffsets(),s=r[i+0],o=r[i+1],h=r[i+2],d=r[i+3],m=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,h,d),t.closePath(),t.fillStrokeShape(this)),m)if(n){var c=n[e],l=2*a;t.drawImage(m,s,o,h,d,c[l+0],c[l+1],h,d)}else t.drawImage(m,s,o,h,d,0,0,h,d)}_hitFunc(t){var e=this.animation(),a=this.frameIndex(),i=4*a,r=this.animations()[e],n=this.frameOffsets(),s=r[i+2],o=r[i+3];if(t.beginPath(),n){var h=n[e],d=2*a;t.rect(h[d+0],h[d+1],s,o)}else t.rect(0,0,s,o);t.closePath(),t.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){var t=this;this.interval=setInterval((function(){t._updateIndex()}),1e3/this.frameRate())}start(){if(!this.isRunning()){var t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){var t=this.frameIndex(),e=this.animation();t<this.animations()[e].length/4-1?this.frameIndex(t+1):this.frameIndex(0)}}exports.Sprite=Sprite,Sprite.prototype.className="Sprite",(0,Global_1._registerNode)(Sprite),Factory_1.Factory.addGetterSetter(Sprite,"animation"),Factory_1.Factory.addGetterSetter(Sprite,"animations"),Factory_1.Factory.addGetterSetter(Sprite,"frameOffsets"),Factory_1.Factory.addGetterSetter(Sprite,"image"),Factory_1.Factory.addGetterSetter(Sprite,"frameIndex",0,(0,Validators_1.getNumberValidator)()),Factory_1.Factory.addGetterSetter(Sprite,"frameRate",17,(0,Validators_1.getNumberValidator)()),Factory_1.Factory.backCompat(Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});
