"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Blur=void 0;const Factory_1=require("../Factory"),Node_1=require("../Node"),Validators_1=require("../Validators");function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function filterGaussBlurRGBA(r,t){var e,a,o,l,u,n,i,s,b,d,c,f,g,x,_,h,B,y,F,v,G,N,S,p,R=r.data,V=r.width,k=r.height,m=t+t+1,q=V-1,w=k-1,A=t+1,M=A*(A+1)/2,j=new BlurStack,O=null,P=j,z=null,C=null,D=mul_table[t],E=shg_table[t];for(o=1;o<m;o++)P=P.next=new BlurStack,o===A&&(O=P);for(P.next=j,i=n=0,a=0;a<k;a++){for(h=B=y=F=s=b=d=c=0,f=A*(v=R[n]),g=A*(G=R[n+1]),x=A*(N=R[n+2]),_=A*(S=R[n+3]),s+=M*v,b+=M*G,d+=M*N,c+=M*S,P=j,o=0;o<A;o++)P.r=v,P.g=G,P.b=N,P.a=S,P=P.next;for(o=1;o<A;o++)l=n+((q<o?q:o)<<2),s+=(P.r=v=R[l])*(p=A-o),b+=(P.g=G=R[l+1])*p,d+=(P.b=N=R[l+2])*p,c+=(P.a=S=R[l+3])*p,h+=v,B+=G,y+=N,F+=S,P=P.next;for(z=j,C=O,e=0;e<V;e++)R[n+3]=S=c*D>>E,0!==S?(S=255/S,R[n]=(s*D>>E)*S,R[n+1]=(b*D>>E)*S,R[n+2]=(d*D>>E)*S):R[n]=R[n+1]=R[n+2]=0,s-=f,b-=g,d-=x,c-=_,f-=z.r,g-=z.g,x-=z.b,_-=z.a,l=i+((l=e+t+1)<q?l:q)<<2,s+=h+=z.r=R[l],b+=B+=z.g=R[l+1],d+=y+=z.b=R[l+2],c+=F+=z.a=R[l+3],z=z.next,f+=v=C.r,g+=G=C.g,x+=N=C.b,_+=S=C.a,h-=v,B-=G,y-=N,F-=S,C=C.next,n+=4;i+=V}for(e=0;e<V;e++){for(B=y=F=h=b=d=c=s=0,f=A*(v=R[n=e<<2]),g=A*(G=R[n+1]),x=A*(N=R[n+2]),_=A*(S=R[n+3]),s+=M*v,b+=M*G,d+=M*N,c+=M*S,P=j,o=0;o<A;o++)P.r=v,P.g=G,P.b=N,P.a=S,P=P.next;for(u=V,o=1;o<=t;o++)n=u+e<<2,s+=(P.r=v=R[n])*(p=A-o),b+=(P.g=G=R[n+1])*p,d+=(P.b=N=R[n+2])*p,c+=(P.a=S=R[n+3])*p,h+=v,B+=G,y+=N,F+=S,P=P.next,o<w&&(u+=V);for(n=e,z=j,C=O,a=0;a<k;a++)R[(l=n<<2)+3]=S=c*D>>E,S>0?(S=255/S,R[l]=(s*D>>E)*S,R[l+1]=(b*D>>E)*S,R[l+2]=(d*D>>E)*S):R[l]=R[l+1]=R[l+2]=0,s-=f,b-=g,d-=x,c-=_,f-=z.r,g-=z.g,x-=z.b,_-=z.a,l=e+((l=a+A)<w?l:w)*V<<2,s+=h+=z.r=R[l],b+=B+=z.g=R[l+1],d+=y+=z.b=R[l+2],c+=F+=z.a=R[l+3],z=z.next,f+=v=C.r,g+=G=C.g,x+=N=C.b,_+=S=C.a,h-=v,B-=G,y-=N,F-=S,C=C.next,n+=V}}const Blur=function(r){var t=Math.round(this.blurRadius());t>0&&filterGaussBlurRGBA(r,t)};exports.Blur=Blur,Factory_1.Factory.addGetterSetter(Node_1.Node,"blurRadius",0,(0,Validators_1.getNumberValidator)(),Factory_1.Factory.afterSetFilter);
