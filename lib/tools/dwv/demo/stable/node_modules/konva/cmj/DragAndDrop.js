"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DD=void 0;const Global_1=require("./Global"),Util_1=require("./Util");exports.DD={get isDragging(){var e=!1;return exports.DD._dragElements.forEach((t=>{"dragging"===t.dragStatus&&(e=!0)})),e},justDragged:!1,get node(){var e;return exports.DD._dragElements.forEach((t=>{e=t.node})),e},_dragElements:new Map,_drag(e){const t=[];exports.DD._dragElements.forEach(((r,o)=>{const{node:n}=r,a=n.getStage();a.setPointersPositions(e),void 0===r.pointerId&&(r.pointerId=Util_1.Util._getFirstPointerId(e));const s=a._changedPointerPositions.find((e=>e.id===r.pointerId));if(s){if("dragging"!==r.dragStatus){var d=n.dragDistance();if(Math.max(Math.abs(s.x-r.startPointerPos.x),Math.abs(s.y-r.startPointerPos.y))<d)return;if(n.startDrag({evt:e}),!n.isDragging())return}n._setDragPosition(e,r),t.push(n)}})),t.forEach((t=>{t.fire("dragmove",{type:"dragmove",target:t,evt:e},!0)}))},_endDragBefore(e){const t=[];exports.DD._dragElements.forEach((r=>{const{node:o}=r,n=o.getStage();e&&n.setPointersPositions(e);if(!n._changedPointerPositions.find((e=>e.id===r.pointerId)))return;"dragging"!==r.dragStatus&&"stopped"!==r.dragStatus||(exports.DD.justDragged=!0,Global_1.Konva._mouseListenClick=!1,Global_1.Konva._touchListenClick=!1,Global_1.Konva._pointerListenClick=!1,r.dragStatus="stopped");const a=r.node.getLayer()||r.node instanceof Global_1.Konva.Stage&&r.node;a&&-1===t.indexOf(a)&&t.push(a)})),t.forEach((e=>{e.draw()}))},_endDragAfter(e){exports.DD._dragElements.forEach(((t,r)=>{"stopped"===t.dragStatus&&t.node.fire("dragend",{type:"dragend",target:t.node,evt:e},!0),"dragging"!==t.dragStatus&&exports.DD._dragElements.delete(r)}))}},Global_1.Konva.isBrowser&&(window.addEventListener("mouseup",exports.DD._endDragBefore,!0),window.addEventListener("touchend",exports.DD._endDragBefore,!0),window.addEventListener("mousemove",exports.DD._drag),window.addEventListener("touchmove",exports.DD._drag),window.addEventListener("mouseup",exports.DD._endDragAfter,!1),window.addEventListener("touchend",exports.DD._endDragAfter,!1));
