"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Arrow=void 0;const Factory_1=require("../Factory"),Line_1=require("./Line"),Validators_1=require("../Validators"),Global_1=require("../Global"),Path_1=require("./Path");class Arrow extends Line_1.Line{_sceneFunc(t){super._sceneFunc(t);var e=2*Math.PI,r=this.points(),a=r,i=0!==this.tension()&&r.length>4;i&&(a=this.getTensionPoints());var o,n,s=this.pointerLength(),h=r.length;if(i){const t=[a[a.length-4],a[a.length-3],a[a.length-2],a[a.length-1],r[h-2],r[h-1]],e=Path_1.Path.calcLength(a[a.length-4],a[a.length-3],"C",t),i=Path_1.Path.getPointOnQuadraticBezier(Math.min(1,1-s/e),t[0],t[1],t[2],t[3],t[4],t[5]);o=r[h-2]-i.x,n=r[h-1]-i.y}else o=r[h-2]-r[h-4],n=r[h-1]-r[h-3];var l=(Math.atan2(n,o)+e)%e,d=this.pointerWidth();this.pointerAtEnding()&&(t.save(),t.beginPath(),t.translate(r[h-2],r[h-1]),t.rotate(l),t.moveTo(0,0),t.lineTo(-s,d/2),t.lineTo(-s,-d/2),t.closePath(),t.restore(),this.__fillStroke(t)),this.pointerAtBeginning()&&(t.save(),t.beginPath(),t.translate(r[0],r[1]),i?(o=(a[0]+a[2])/2-r[0],n=(a[1]+a[3])/2-r[1]):(o=r[2]-r[0],n=r[3]-r[1]),t.rotate((Math.atan2(-n,-o)+e)%e),t.moveTo(0,0),t.lineTo(-s,d/2),t.lineTo(-s,-d/2),t.closePath(),t.restore(),this.__fillStroke(t))}__fillStroke(t){var e=this.dashEnabled();e&&(this.attrs.dashEnabled=!1,t.setLineDash([])),t.fillStrokeShape(this),e&&(this.attrs.dashEnabled=!0)}getSelfRect(){const t=super.getSelfRect(),e=this.pointerWidth()/2;return{x:t.x-e,y:t.y-e,width:t.width+2*e,height:t.height+2*e}}}exports.Arrow=Arrow,Arrow.prototype.className="Arrow",(0,Global_1._registerNode)(Arrow),Factory_1.Factory.addGetterSetter(Arrow,"pointerLength",10,(0,Validators_1.getNumberValidator)()),Factory_1.Factory.addGetterSetter(Arrow,"pointerWidth",10,(0,Validators_1.getNumberValidator)()),Factory_1.Factory.addGetterSetter(Arrow,"pointerAtBeginning",!1),Factory_1.Factory.addGetterSetter(Arrow,"pointerAtEnding",!0);
