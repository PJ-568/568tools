"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Image=void 0;const Util_1=require("../Util"),Factory_1=require("../Factory"),Shape_1=require("../Shape"),Global_1=require("../Global"),Validators_1=require("../Validators");class Image extends Shape_1.Shape{constructor(t){super(t),this.on("imageChange.konva",(()=>{this._setImageLoad()})),this._setImageLoad()}_setImageLoad(){const t=this.image();t&&t.complete||t&&4===t.readyState||t&&t.addEventListener&&t.addEventListener("load",(()=>{this._requestDraw()}))}_useBufferCanvas(){return super._useBufferCanvas(!0)}_sceneFunc(t){const e=this.getWidth(),a=this.getHeight(),r=this.cornerRadius(),i=this.attrs.image;let o;if(i){const t=this.attrs.cropWidth,r=this.attrs.cropHeight;o=t&&r?[i,this.cropX(),this.cropY(),t,r,0,0,e,a]:[i,0,0,e,a]}(this.hasFill()||this.hasStroke()||r)&&(t.beginPath(),r?Util_1.Util.drawRoundedRectPath(t,e,a,r):t.rect(0,0,e,a),t.closePath(),t.fillStrokeShape(this)),i&&(r&&t.clip(),t.drawImage.apply(t,o))}_hitFunc(t){var e=this.width(),a=this.height(),r=this.cornerRadius();t.beginPath(),r?Util_1.Util.drawRoundedRectPath(t,e,a,r):t.rect(0,0,e,a),t.closePath(),t.fillStrokeShape(this)}getWidth(){var t,e;return null!==(t=this.attrs.width)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.width}getHeight(){var t,e;return null!==(t=this.attrs.height)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.height}static fromURL(t,e,a=null){var r=Util_1.Util.createImageElement();r.onload=function(){var t=new Image({image:r});e(t)},r.onerror=a,r.crossOrigin="Anonymous",r.src=t}}exports.Image=Image,Image.prototype.className="Image",(0,Global_1._registerNode)(Image),Factory_1.Factory.addGetterSetter(Image,"cornerRadius",0,(0,Validators_1.getNumberOrArrayOfNumbersValidator)(4)),Factory_1.Factory.addGetterSetter(Image,"image"),Factory_1.Factory.addComponentsGetterSetter(Image,"crop",["x","y","width","height"]),Factory_1.Factory.addGetterSetter(Image,"cropX",0,(0,Validators_1.getNumberValidator)()),Factory_1.Factory.addGetterSetter(Image,"cropY",0,(0,Validators_1.getNumberValidator)()),Factory_1.Factory.addGetterSetter(Image,"cropWidth",0,(0,Validators_1.getNumberValidator)()),Factory_1.Factory.addGetterSetter(Image,"cropHeight",0,(0,Validators_1.getNumberValidator)());
