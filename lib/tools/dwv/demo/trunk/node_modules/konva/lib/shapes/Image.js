import{Util}from"../Util.js";import{Factory}from"../Factory.js";import{Shape}from"../Shape.js";import{_registerNode}from"../Global.js";import{getNumberOrArrayOfNumbersValidator,getNumberValidator}from"../Validators.js";export class Image extends Shape{constructor(t){super(t),this.on("imageChange.konva",(()=>{this._setImageLoad()})),this._setImageLoad()}_setImageLoad(){const t=this.image();t&&t.complete||t&&4===t.readyState||t&&t.addEventListener&&t.addEventListener("load",(()=>{this._requestDraw()}))}_useBufferCanvas(){return super._useBufferCanvas(!0)}_sceneFunc(t){const e=this.getWidth(),r=this.getHeight(),a=this.cornerRadius(),i=this.attrs.image;let o;if(i){const t=this.attrs.cropWidth,a=this.attrs.cropHeight;o=t&&a?[i,this.cropX(),this.cropY(),t,a,0,0,e,r]:[i,0,0,e,r]}(this.hasFill()||this.hasStroke()||a)&&(t.beginPath(),a?Util.drawRoundedRectPath(t,e,r,a):t.rect(0,0,e,r),t.closePath(),t.fillStrokeShape(this)),i&&(a&&t.clip(),t.drawImage.apply(t,o))}_hitFunc(t){var e=this.width(),r=this.height(),a=this.cornerRadius();t.beginPath(),a?Util.drawRoundedRectPath(t,e,r,a):t.rect(0,0,e,r),t.closePath(),t.fillStrokeShape(this)}getWidth(){var t,e;return null!==(t=this.attrs.width)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.width}getHeight(){var t,e;return null!==(t=this.attrs.height)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.height}static fromURL(t,e,r=null){var a=Util.createImageElement();a.onload=function(){var t=new Image({image:a});e(t)},a.onerror=r,a.crossOrigin="Anonymous",a.src=t}}Image.prototype.className="Image",_registerNode(Image),Factory.addGetterSetter(Image,"cornerRadius",0,getNumberOrArrayOfNumbersValidator(4)),Factory.addGetterSetter(Image,"image"),Factory.addComponentsGetterSetter(Image,"crop",["x","y","width","height"]),Factory.addGetterSetter(Image,"cropX",0,getNumberValidator()),Factory.addGetterSetter(Image,"cropY",0,getNumberValidator()),Factory.addGetterSetter(Image,"cropWidth",0,getNumberValidator()),Factory.addGetterSetter(Image,"cropHeight",0,getNumberValidator());
