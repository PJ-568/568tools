import{Factory}from"../Factory.js";import{Shape}from"../Shape.js";import{Group}from"../Group.js";import{getNumberOrArrayOfNumbersValidator,getNumberValidator}from"../Validators.js";import{_registerNode}from"../Global.js";var ATTR_CHANGE_LIST=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],CHANGE_KONVA="Change.konva",NONE="none",UP="up",RIGHT="right",DOWN="down",LEFT="left",attrChangeListLen=ATTR_CHANGE_LIST.length;export class Label extends Group{constructor(t){super(t),this.on("add.konva",(function(t){this._addListeners(t.child),this._sync()}))}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(t){var e,i=this,r=function(){i._sync()};for(e=0;e<attrChangeListLen;e++)t.on(ATTR_CHANGE_LIST[e]+CHANGE_KONVA,r)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){var t,e,i,r,a,o,n,h=this.getText(),s=this.getTag();if(h&&s){switch(t=h.width(),e=h.height(),i=s.pointerDirection(),r=s.pointerWidth(),n=s.pointerHeight(),a=0,o=0,i){case UP:a=t/2,o=-1*n;break;case RIGHT:a=t+r,o=e/2;break;case DOWN:a=t/2,o=e+n;break;case LEFT:a=-1*r,o=e/2}s.setAttrs({x:-1*a,y:-1*o,width:t,height:e}),h.setAttrs({x:-1*a,y:-1*o})}}}Label.prototype.className="Label",_registerNode(Label);export class Tag extends Shape{_sceneFunc(t){var e=this.width(),i=this.height(),r=this.pointerDirection(),a=this.pointerWidth(),o=this.pointerHeight(),n=this.cornerRadius();let h=0,s=0,T=0,g=0;"number"==typeof n?h=s=T=g=Math.min(n,e/2,i/2):(h=Math.min(n[0]||0,e/2,i/2),s=Math.min(n[1]||0,e/2,i/2),g=Math.min(n[2]||0,e/2,i/2),T=Math.min(n[3]||0,e/2,i/2)),t.beginPath(),t.moveTo(h,0),r===UP&&(t.lineTo((e-a)/2,0),t.lineTo(e/2,-1*o),t.lineTo((e+a)/2,0)),t.lineTo(e-s,0),t.arc(e-s,s,s,3*Math.PI/2,0,!1),r===RIGHT&&(t.lineTo(e,(i-o)/2),t.lineTo(e+a,i/2),t.lineTo(e,(i+o)/2)),t.lineTo(e,i-g),t.arc(e-g,i-g,g,0,Math.PI/2,!1),r===DOWN&&(t.lineTo((e+a)/2,i),t.lineTo(e/2,i+o),t.lineTo((e-a)/2,i)),t.lineTo(T,i),t.arc(T,i-T,T,Math.PI/2,Math.PI,!1),r===LEFT&&(t.lineTo(0,(i+o)/2),t.lineTo(-1*a,i/2),t.lineTo(0,(i-o)/2)),t.lineTo(0,h),t.arc(h,h,h,Math.PI,3*Math.PI/2,!1),t.closePath(),t.fillStrokeShape(this)}getSelfRect(){var t=0,e=0,i=this.pointerWidth(),r=this.pointerHeight(),a=this.pointerDirection(),o=this.width(),n=this.height();return a===UP?(e-=r,n+=r):a===DOWN?n+=r:a===LEFT?(t-=1.5*i,o+=i):a===RIGHT&&(o+=1.5*i),{x:t,y:e,width:o,height:n}}}Tag.prototype.className="Tag",_registerNode(Tag),Factory.addGetterSetter(Tag,"pointerDirection",NONE),Factory.addGetterSetter(Tag,"pointerWidth",0,getNumberValidator()),Factory.addGetterSetter(Tag,"pointerHeight",0,getNumberValidator()),Factory.addGetterSetter(Tag,"cornerRadius",0,getNumberOrArrayOfNumbersValidator(4));
