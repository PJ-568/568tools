<!doctype html><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Page Title</title><meta name=viewport content="width=device-width,initial-scale=1"><input id=files type=file multiple><h4 id=t1></h4><img id=img01 src="" alt=""><canvas id=can></canvas><h4 id=t2></h4><img id=img02 src="" alt=""><script>let input=document.getElementById("files"),img01=document.getElementById("img01"),img02=document.getElementById("img02");input.addEventListener("change",(function(){console.log(this.files[0]);let e=this.files,t=new Image;t.src=URL.createObjectURL(this.files[0]),t.onload=function(){console.log(this);let t=document.getElementById("can"),i=this.width,o=this.height;t.setAttribute("width",i),t.setAttribute("height",o),t.getContext("2d").drawImage(this,0,0,i,o),console.log(t);let n=7e4,s=(e[0].size,this.width,this.height,this.width,this.height,n/e[0].size);s>1&&(s=1),s<0&&(s=.01),function i(o,n){e[0].size;let s,l=n;t.toBlob((function(e){if(img02.src=URL.createObjectURL(e),s=e.size,console.log(e,"setSize:",o,"q:",n),o>s&&.9*o<s)console.log(e,"✅✅✅✅");else{if(l=l*o/s,l>1||l<0)return void(o>s?console.log(e,"最大输出质量✅✅✅✅"):console.warn("没有合适的"));console.log("继续"),i(o,l)}}),"image/jpeg",n)}(n,1)}}),!1)</script>
