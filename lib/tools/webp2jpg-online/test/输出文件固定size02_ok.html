<!doctype html><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Page Title</title><meta name=viewport content="width=device-width,initial-scale=1"><input id=files type=file multiple><h4 id=t1></h4><img id=img01 src="" alt=""><canvas id=can></canvas><h4 id=t2></h4><img id=img02 src="" alt=""><script>let input=document.getElementById("files"),img01=document.getElementById("img01"),img02=document.getElementById("img02");input.addEventListener("change",(function(){console.log(this.files[0]);this.files;let e=new Image,t=0;e.src=URL.createObjectURL(this.files[0]),e.onload=function(){console.log(this);let e=document.getElementById("can"),o=this.width,n=this.height;e.setAttribute("width",o),e.setAttribute("height",n),e.getContext("2d").drawImage(this,0,0,o,n),console.log(e),e.toBlob((function(o){console.log(o,"完成0.81");let n=102400;n-=4e3;let c=o.size,i=n/c*(n>c?.81*.81:.81);i>=1&&(i=.99),i<=0&&(i=.01),function o(n,c){e.toBlob((function(e){console.log("count:",t++),console.log(e,c,"继续"),img02.src=URL.createObjectURL(e);let i=e.size;i>.9*n&&i<n?console.log(e,URL.createObjectURL(e),c,"完成✅✅✅"):c>=.95&&i<n?console.warn(e,c,URL.createObjectURL(e),"最大输出✅"):c<1e-4&&i>n?console.error(e,c,URL.createObjectURL(e),"没有符合的🙅"):c<1e-4&&i<n?console.warn(e,c,URL.createObjectURL(e),"最小输出✅"):(i<n?c+=.01:c-=.01,o(n,c.toFixed(2)-0))}),"image/webp",c)}(n,i.toFixed(2)-0)}),"image/webp",.81)}}),!1)</script>
