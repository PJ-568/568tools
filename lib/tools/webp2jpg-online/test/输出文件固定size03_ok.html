<!doctype html><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Page Title</title><meta name=viewport content="width=device-width,initial-scale=1"><input id=files type=file multiple><h4 id=t1></h4><img id=img01 src="" alt=""><canvas id=can></canvas><h4 id=t2></h4><img id=img02 src="" alt=""><script>let input=document.getElementById("files"),img01=document.getElementById("img01"),img02=document.getElementById("img02");function funMaxSize({defWidth:e,defHeight:t,setWidth:i,setHeight:o,imageData:n,setSize:c=100}){return new Promise((e,t)=>{let i=arguments[0],o=0,n=document.getElementById("can"),c=i.setWidth||i.defWidth,s=i.setHeight||i.setWidth/i.defWidth*i.defHeight;n.setAttribute("width",c),n.setAttribute("height",s),n.getContext("2d").drawImage(i.imageData,0,0,c,s),console.log(n),n.toBlob((function(c){console.log(c,"完成0.81");let s=1e3*i.setSize;s-=4e3;let l=c.size,d=s/l*(s>l?.81*.81:.81);d>=1&&(d=.99),d<=0&&(d=.01),function i(c,s){n.toBlob((function(n){console.log("count:",o++),console.log(n,s,"继续"),img02.src=URL.createObjectURL(n);let l=n.size;return l>.9*c&&l<c?(console.log(n,URL.createObjectURL(n),s,"完成✅✅✅"),void e(URL.createObjectURL(n))):s>=.95&&l<c?(console.warn(n,s,URL.createObjectURL(n),"最大输出✅"),void e(URL.createObjectURL(n))):s<1e-4&&l>c?(console.error(n,s,URL.createObjectURL(n),"没有符合的🙅"),void t(URL.createObjectURL(n))):s<1e-4&&l<c?(console.warn(n,s,URL.createObjectURL(n),"最小输出✅"),void e(URL.createObjectURL(n))):(l<c?s+=.01:s-=.01,void i(c,s.toFixed(2)-0))}),"image/webp",s)}(s,d.toFixed(2)-0)}),"image/webp",.81)})}input.addEventListener("change",(function(){console.log(this.files[0]);this.files;let e=new Image;e.src=URL.createObjectURL(this.files[0]),e.onload=async function(){console.log(this);let e=await funMaxSize({defWidth:this.width,defHeight:this.height,setWidth:400,setHeight:null,imageData:this,setSize:88});console.log("😊 结果：",e,JSON.stringify(this))}}),!1)</script>
