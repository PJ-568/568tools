class TouchEvent{constructor({mindMap:t}){this.mindMap=t,this.touchesNum=0,this.singleTouchstartEvent=null,this.clickNum=0,this.doubleTouchmoveDistance=0,this.bindEvent()}bindEvent(){this.onTouchstart=this.onTouchstart.bind(this),this.onTouchmove=this.onTouchmove.bind(this),this.onTouchcancel=this.onTouchcancel.bind(this),this.onTouchend=this.onTouchend.bind(this),window.addEventListener("touchstart",this.onTouchstart),window.addEventListener("touchmove",this.onTouchmove),window.addEventListener("touchcancel",this.onTouchcancel),window.addEventListener("touchend",this.onTouchend)}unBindEvent(){window.removeEventListener("touchstart",this.onTouchstart),window.removeEventListener("touchmove",this.onTouchmove),window.removeEventListener("touchcancel",this.onTouchcancel),window.removeEventListener("touchend",this.onTouchend)}onTouchstart(t){if(this.touchesNum=t.touches.length,1===this.touchesNum){let e=t.touches[0];this.singleTouchstartEvent=e,this.dispatchMouseEvent("mousedown",e.target,e)}}onTouchmove(t){let e=t.touches.length;if(1===e){let e=t.touches[0];this.dispatchMouseEvent("mousemove",e.target,e)}else if(2===e){let e=t.touches[0],n=t.touches[1],i=e.clientX-n.clientX,o=e.clientY-n.clientY,s=Math.sqrt(Math.pow(i,2)+Math.pow(o,2)),{x:h,y:c}=this.mindMap.toPos(e.clientX,e.clientY),{x:u,y:l}=this.mindMap.toPos(n.clientX,n.clientY),a=(h+u)/2,d=(c+l)/2;s>this.doubleTouchmoveDistance?this.mindMap.view.enlarge(a,d):this.mindMap.view.narrow(a,d),this.doubleTouchmoveDistance=s}}onTouchcancel(t){}onTouchend(t){if(this.dispatchMouseEvent("mouseup",t.target),1===this.touchesNum){this.clickNum++,setTimeout((()=>{this.clickNum=0}),300);let t=this.singleTouchstartEvent;this.clickNum>1?(this.clickNum=0,this.dispatchMouseEvent("dblclick",t.target,t)):this.dispatchMouseEvent("click",t.target,t)}this.touchesNum=0,this.singleTouchstartEvent=null,this.doubleTouchmoveDistance=0}dispatchMouseEvent(t,e,n){let i={};n&&(i={screenX:n.screenX,screenY:n.screenY,clientX:n.clientX,clientY:n.clientY,which:1});let o=new MouseEvent(t,{view:window,bubbles:!0,cancelable:!0,...i});e.dispatchEvent(o)}beforePluginRemove(){this.unBindEvent()}}TouchEvent.instanceName="touchEvent";export default TouchEvent;
