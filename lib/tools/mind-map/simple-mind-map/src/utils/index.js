export const walk=(e,t,n,o,r,l=0,a=0)=>{let i=!1;if(n&&(i=n(e,t,r,l,a)),!i&&e.children&&e.children.length>0){let t=l+1;e.children.forEach(((r,l)=>{walk(r,e,n,o,!1,t,l)}))}o&&o(e,t,r,l,a)};export const bfsWalk=(e,t)=>{t(e);let n=[e],o=!1;for(;n.length&&!o;){let e=n.shift();e.children&&e.children.length&&e.children.forEach((e=>{n.push(e),"stop"===t(e)&&(o=!0)}))}};export const resizeImgSize=(e,t,n,o)=>{let r=e/t,l=[];if(n&&o)if(e<=n&&t<=o)l=[e,t];else{l=r>n/o?[r*o,o]:[n,n/r]}else n?l=e<=n?[e,t]:[n,n/r]:o&&(l=t<=o?[e,t]:[r*o,o]);return l};export const resizeImg=(e,t,n)=>new Promise(((o,r)=>{let l=new Image;l.src=e,l.onload=()=>{let e=resizeImgSize(l.naturalWidth,l.naturalHeight,t,n);o(e)},l.onerror=e=>{r(e)}}));export const getStrWithBrFromHtml=e=>{e=e.replace(/<br>/gim,"\n");let t=document.createElement("div");return t.innerHTML=e,e=t.textContent};export const simpleDeepClone=e=>{try{return JSON.parse(JSON.stringify(e))}catch(e){return null}};export const copyRenderTree=(e,t,n=!1)=>(e.data=simpleDeepClone(t.data),n&&(e.data.isActive=!1),e.children=[],t.children&&t.children.length>0&&t.children.forEach(((t,o)=>{e.children[o]=copyRenderTree({},t,n)})),e);export const copyNodeTree=(e,t,n=!1,o=!1)=>(e.data=simpleDeepClone(t.nodeData?t.nodeData.data:t.data),e.data.id&&!o&&delete e.data.id,e.data.uid&&delete e.data.uid,n&&(e.data.isActive=!1),e.children=[],t.children&&t.children.length>0?t.children.forEach(((t,r)=>{e.children[r]=copyNodeTree({},t,n,o)})):t.nodeData&&t.nodeData.children&&t.nodeData.children.length>0&&t.nodeData.children.forEach(((t,r)=>{e.children[r]=copyNodeTree({},t,n,o)})),e);export const imgToDataUrl=e=>new Promise(((t,n)=>{const o=new Image;o.setAttribute("crossOrigin","anonymous"),o.onload=()=>{try{let e=document.createElement("canvas");e.width=o.width,e.height=o.height,e.getContext("2d").drawImage(o,0,0,o.width,o.height),t(e.toDataURL())}catch(e){n(e)}},o.onerror=e=>{n(e)},o.src=e}));export const downloadFile=(e,t)=>{let n=document.createElement("a");n.href=e,n.download=t,n.click()};export const throttle=(e,t=300,n)=>{let o=null;return(...r)=>{o||(o=setTimeout((()=>{e.call(n,...r),o=null}),t))}};export const asyncRun=(e,t=(()=>{}))=>{let n=0,o=e.length;if(o<=0)return t();let r=()=>{n>=o?t():(e[n](),setTimeout((()=>{n++,r()}),0))};r()};export const degToRad=e=>e*(Math.PI/180);export const camelCaseToHyphen=e=>e.replace(/([a-z])([A-Z])/g,((...e)=>e[1]+"-"+e[2].toLowerCase()));let measureTextContext=null;export const measureText=(e,{italic:t,bold:n,fontSize:o,fontFamily:r})=>{const l=joinFontStr({italic:t,bold:n,fontSize:o,fontFamily:r});if(!measureTextContext){const e=document.createElement("canvas");measureTextContext=e.getContext("2d")}measureTextContext.save(),measureTextContext.font=l;const{width:a,actualBoundingBoxAscent:i,actualBoundingBoxDescent:c}=measureTextContext.measureText(e);measureTextContext.restore();return{width:a,height:i+c}};export const joinFontStr=({italic:e,bold:t,fontSize:n,fontFamily:o})=>`${e?"italic ":""} ${t?"bold ":""} ${n}px ${o} `;export const nextTick=function(e,t){let n=!1,o=null,r=()=>{n=!1,t?e.call(t):e()};if("undefined"!=typeof MutationObserver){let e=1,t=new MutationObserver(r),n=document.createTextNode(e);t.observe(n,{characterData:!0}),o=function(){e=(e+1)%2,n.data=e}}else o=setTimeout;return function(){n||(n=!0,o(r,0))}};export const checkNodeOuter=(e,t)=>{let n=e.elRect,{scaleX:o,scaleY:r,translateX:l,translateY:a}=e.draw.transform(),{left:i,top:c,width:d,height:s}=t,h=(i+d)*o+l,m=(c+s)*r+a;i=i*o+l,c=c*r+a;let u=0,x=0;return i<0&&(u=-i),h>n.width&&(u=-(h-n.width)),c<0&&(x=-c),m>n.height&&(x=-(m-n.height)),{isOuter:0!==u||0!==x,offsetLeft:u,offsetTop:x}};let getTextFromHtmlEl=null;export const getTextFromHtml=e=>(getTextFromHtmlEl||(getTextFromHtmlEl=document.createElement("div")),getTextFromHtmlEl.innerHTML=e,getTextFromHtmlEl.textContent);export const readBlob=e=>new Promise(((t,n)=>{let o=new FileReader;o.onload=e=>{t(e.target.result)},o.onerror=e=>{n(e)},o.readAsDataURL(e)}));let nodeToHTMLWrapEl=null;export const nodeToHTML=e=>(nodeToHTMLWrapEl||(nodeToHTMLWrapEl=document.createElement("div")),nodeToHTMLWrapEl.innerHTML="",nodeToHTMLWrapEl.appendChild(e),nodeToHTMLWrapEl.innerHTML);
