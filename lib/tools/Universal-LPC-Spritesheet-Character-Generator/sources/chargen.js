function loadFile(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t.responseText}function splitCsv(e){return e.split(",").reduce(((e,t)=>(e.isConcatting?e.soFar[e.soFar.length-1]+=","+t:e.soFar.push(t),t.split('"').length%2==0&&(e.isConcatting=!e.isConcatting),e)),{soFar:[],isConcatting:!1}).soFar}_.mixin(_.str.exports()),$.expr[":"].icontains=function(e,t,n){return jQuery(e).text().toUpperCase().indexOf(n[3].toUpperCase())>=0},$(document).ready((function(){var e=!0,t=[],n={},i=jHash.val(),o=[];const a=(r="CREDITS.csv",s=new XMLHttpRequest,s.open("GET",r,!1),s.send(),s.responseText).split("\n");var r,s,c=a[0],l=$("#spritesheet").get(0),d=l.getContext("2d",{willReadFrequently:!0}),h={};const u=64,p=832,m=1344;var f=$("#previewAnimations").get(0),g=f.getContext("2d"),v=[1,2,3,4,5,6,7,8],w=8,y=4,C=0,x="",k=[];function A(e){$(".search-result").removeClass("search-result");let t=$("#searchbox").val();if(""!=t&&t.length>1){let e=$("#chooser span:icontains("+t+")").addClass("search-result").parents("ul");e.prev("span").addClass("expanded").removeClass("condensed"),e.show().promise().done(U)}}function I(){for(var e=0;e<k.length;++e)$("#whichAnim").children(`option[value=${k[e]}]`).remove()}function j(){$("#body-Body_color_light").prop("checked",!0),$("#head-Human_male_light").prop("checked",!0),P()}function b(e){if(""!==e)for(let t of a)if(t.startsWith(e))return t}function R(e){if(""!==e){let t=b(e);t?o.push(t):o.push(e+",!MISSING LICENSE INFORMATION! PLEASE CORRECT MANUALY AND REPORT BACK VIA A GITHUB ISSUE,,,,,,,,BAD")}$("textarea#creditsText").val(S())}function S(){let e=function(e){for(var t=[],n=!1,i=0,o=0,a=0;a<e.length;a++){var r=e[a],s=e[a+1];t[i]=t[i]||[],t[i][o]=t[i][o]||"",'"'==r&&n&&'"'==s?(t[i][o]+=r,++a):'"'!=r?","!=r||n?"\r"!=r||"\n"!=s||n?("\n"!=r||n)&&("\r"!=r||n)?t[i][o]+=r:(++i,o=0):(++i,o=0,++a):++o:n=!n}return t}(o.join("\n")),t=e.slice(1).map((e=>e[2].split(",").map((e=>e.trim())))).flat();t=[...new Set(t)];let n=e.slice(1).map((function(e){let t=e.slice(4,9).filter((function(e){return!!e})).map((function(e){return"    - "+e}));return[`- ${e[0]}: by ${e[2]}. License(s): ${e[3]}. ${e[1]}`].concat(t).join("\n")}));return"Authors: "+t.join(", ")+"\n\n"+n.join("\n\n")}function T(){document.querySelector("img");var e=document.querySelector("input[type=file]").files[0],t=new Image;t.onload=function(){h.uploaded=t,L(),N()},t.src=URL.createObjectURL(e)}function E(){return $("#sex-male").prop("checked")?"male":$("#sex-female").prop("checked")?"female":$("#sex-teen").prop("checked")?"teen":$("#sex-child").prop("checked")?"child":$("#sex-muscular").prop("checked")?"muscular":$("#sex-pregnant").prop("checked")?"pregnant":"ERROR"}function L(){t=[];const e=E();o=[c];var i=window.location.href.split("/").slice(0,-1).join("/");if(n={bodyTypeName:e,url:window.location.href,spritesheets:i+"/spritesheets/",version:1,datetime:(new Date).toLocaleString(),credits:""},zPosition=0,$("input[type=radio]:checked").each((function(n){for(jdx=1;jdx<10&&$(this).data(`layer_${jdx}_${e}`);jdx++){const n=$(this).data(`layer_${jdx}_zpos`),i=$(this).data(`layer_${jdx}_custom_animation`),o=$(this).data(`layer_${jdx}_${e}`),a=$(this).attr("name"),r=$(this).attr("parentName"),s=$(this).attr("variant");if(""!==o){const e={};e.fileName=o,e.zPos=n,e.custom_animation=i,e.parentName=a,e.name=r,e.variant=s,R(o),t.push(e)}}})),n.credits=S(),null!=h.uploaded){const e={fileName:"uploaded"};e.zPos=parseInt(document.getElementById("ZPOS").value)||0,t.push(e)}!function(e){d.clearRect(0,0,l.width,l.height);var t=m,n=p;I(),k=[];for(var i=0;i<e.length;++i){const o=e[i].custom_animation;if(void 0!==o){if(k.includes(o))continue;k.push(o);const e=customAnimations[o],i=e.frameSize*e.frames[0].length,a=e.frameSize*e.frames.length;n=Math.max(n,i),t+=a}}l.width=n,l.height=t,$("#chooser").css("height",l.height);var o=0,a="";for(item in e.sort((function(e,t){return parseInt(e.zPos)-parseInt(t.zPos)})),e){const l=z(e[o].fileName),h=e[o].custom_animation;if(void 0!==h){const p=customAnimations[h],f=p.frameSize,$=document.createElement("canvas");$.width=n,$.height=t-m;const g=$.getContext("2d"),v=k.indexOf(h);var r=0;for(i=0;i<v;++i){const e=customAnimations[k[i]];r+=e.frameSize*e.frames.length}if(a!==h){for(i=0;i<p.frames.length;++i){const e=p.frames[i];for(var s=0;s<e.length;++s){const t=parseInt(e[s].split(",")[1]),n=e[s].split(",")[0],o=animationRowsLayout[n]+1,a=(f-u)/2;var c=d.getImageData(u*t,u*o,u,u);g.putImageData(c,f*s+a,f*i+a+r)}}d.drawImage($,0,m),e[o].zPos>=140&&(a=h)}d.drawImage(l,0,m+r)}else B(d,l);o+=1}!function(){I();for(var e=0;e<k.length;++e)$("#whichAnim").append(new Option(`${k[e]}`,`${k[e]}`))}()}(t)}function N(){$("li").each((function(e){$(this).data("required")&&($(this).data("required").split(",").includes(E())?$(this).prop("style",""):$(this).prop("style","display:none"))}))}function O(){$("input[type=radio]").each((function(){var e=_.words($(this).attr("id"),"-"),t=_.initial(e).join("-");$(this).prop("checked",$(this).attr("checked")||i[t]==_.last(e))}))}function P(){$("input[type=radio]:checked").each((function(){var e=_.words($(this).attr("id"),"-"),t=_.initial(e).join("-");$(this).attr("checked")&&!i[t]||(i[t]=_.last(e))})),jHash.val(i)}function z(e){if(h[e])return h[e];var t=new Image;return t.src="spritesheets/"+e,t.onload=L,h[e]=t,t}function B(e,t){try{e.drawImage(t,0,0),zPosition++}catch(e){console.error("Error: could not find "+t.src)}}function U(){this.find("input[type=radio]").filter((function(){return $(this).is(":visible")})).each((function(){if($this=$(this),!$this.parent().hasClass("hasPreview")&&!$this.parent().hasClass("noPreview")){var e=document.createElement("canvas");e.setAttribute("width",u),e.setAttribute("height",u);var t,n=e.getContext("2d");const i=parseInt($(this).data("preview_row"));t=function(e,t){if(h[e])return t(h[e]),h[e];var n=new Image;return n.src="spritesheets/"+e,n.onload=function(){t(n)},h[e]=n,n}($(this).data(`layer_1_${E()}`),(function(e){try{n.drawImage(e,0,i*u,u,u,0,0,u,u)}catch(e){console.log(e)}})),null!=t&&(this.parentNode.insertBefore(e,this),$(this).parent().addClass("hasPreview").parent().addClass("hasPreview"))}}))}jHash.change((function(){i=jHash.val(),O(),L(),N()})),O(),0==Object.keys(i).length&&($("input[type=reset]").click(),P(),j()),L(),N(),function e(){$("#whichAnim>:selected").text();g.clearRect(0,0,f.width,f.height),C=(C+1)%v.length;const t=v[C];var n=u,i=0;if(""!==x){n=customAnimations[x].frameSize;const e=k.indexOf(x);i=m;for(var o=0;o<e;++o){const e=customAnimations[k[o]];i+=e.frameSize*e.frames.length}}for(o=0;o<y;++o)g.drawImage(l,t*n,i+(w+o)*n,n,n,o*n,0,n,n);setTimeout(e,125)}(),$("input[type=radio]").attr("title",(function(){var e="";if($(this).data(`layer_1_${E()}`)&&(e=$(this).data(`layer_1_${E()}`)),""===e)return"";const t=b(e);if(!t)return console.warn("No credit entry for: ",e),"No credits found for this graphic";{let e=splitCsv(t);if(10==e.length)return"Created by: "+e[2]}return t})),$("input[type=radio]").each((function(){$(this).click((function(){e&&(matchBodyColorForThisAsset=$(this).attr("matchBodyColor"),matchBodyColorForThisAsset&&"false"!=matchBodyColorForThisAsset&&function(e){const t=e;$("input[matchBodyColor^=true]:checked").each((function(){const e=$(this).attr("parentName").replaceAll(" ","_"),n=$(this).attr("name")+"-"+e+"_"+t;$(`#${n}`).prop("checked",!0)})),P()}($(this).attr("variant"))),P(),L(),N()}))})),$("#chooser ul>li").click((function(e){$(this).children("span").toggleClass("condensed").toggleClass("expanded"),$(this).children("ul").toggle("slow").promise().done(U),e.stopPropagation()})),$("#collapse").click((function(){$("#chooser>ul ul").hide("slow"),$("#chooser>ul span.expanded").removeClass("expanded").addClass("condensed")})),$("#expand").click((function(){let e=$('input[type="radio"]:checked').parents("ul");e.prev("span").addClass("expanded"),e.show().promise().done(U)})),$("#searchbox").on("search",A),$("#search").click(A),$("#customizeChar").on("submit",(function(e){A(),e.preventDefault()})),$("#displayMode-compact").click((function(){$("#chooser").toggleClass("compact")})),$("#match_body-color").click((function(){e=$(this).is(":checked")})),$("#scroll-to-credits").click((function(e){$("#credits")[0].scrollIntoView(),e.preventDefault()})),$("#previewFile").change((function(){T()})),$("#ZPOS").change((function(){T()})),$("#saveAsPNG").click((function(){var e,t,n;return e=this,t=l,n="Download"+Math.floor(1e5*Math.random())+".png",e.href=t.toDataURL(),e.download=n,!0})),$("#resetAll").click((function(){window.setTimeout((function(){document.getElementById("previewFile").value="",h.uploaded=null,document.getElementById("ZPOS").value=0,i={},jHash.val(i),O(),j(),L(),N()}),0,!1)})),$(".replacePinkMask").click((function(){for(var e=d.getImageData(0,0,l.width,l.height),t=e.data,n=0,i=t.length;n<i;n+=4){if(t[n+3]>0){const e=t[n],i=t[n+1],o=t[n+2];255===e&&44===i&&230===o&&(t[n+3]=0)}}d.putImageData(e,0,0)})),$(".generateSheetCreditsCsv").click((function(){let e=new Blob([o.join("\n")],{type:"text/html"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="sheet-credits.csv",t.hidden=!0,document.body.appendChild(t),t.innerHTML="dummyhtml",t.click(),document.removeChild(t)})),$(".exportToClipboard").click((function(){var e={};Object.assign(e,n),e.layers=t,navigator.clipboard.writeText(JSON.stringify(e,null,"  "))})),$(".generateSheetCreditsTxt").click((function(){let e=new Blob([S()],{type:"text/html"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="sheet-credits.txt",t.hidden=!0,document.body.appendChild(t),t.innerHTML="dummyhtml",t.click(),document.removeChild(t)})),$(".generateAllCredits").click((function(){let e=new Blob([a.join("\n")],{type:"text/html"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="all-credits.csv",t.hidden=!0,document.body.appendChild(t),t.innerHTML="dummyhtml",t.click(),document.removeChild(t)})),$("#whichAnim").change((function(){v=[];const e=$("#whichAnim>:selected"),t=$("#whichAnim>:selected").text(),n=parseInt(e.data("cycle"));if(w=parseInt(e.data("row")),y=parseInt(e.data("num")),C=0,k.includes(t)&&(x=t),""!==x){const e=customAnimations[x];y=e.frames.length,w=0;for(var i=0;i<e.frames[0].length;++i)v.push(i);return}const o=e.data("cycle-custom");if(!(void 0!==o&&(v=o.split("-").map(Number)).length>0))for(i=1;i<n;++i)v.push(i)})),$("#spritesheet,#previewAnimations").on("click",(function(e){$(this).toggleClass("zoomed")}))}));
