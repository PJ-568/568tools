var next=function(){var n=0;return function(){return{prev:n,next:n=(n+1)%2}}}();function onChange(n,t){var a=n.val();return n.on("input",(function(){var e,o=n.val();a!==o&&(e=a,a=o,"function"==typeof t&&t.call(n,o,e))})),{trigger:function(){"function"==typeof t&&t.call(n,n.val(),a)}}}var fadeOptions={duration:100,queue:!1},canvas=document.createElement("canvas"),saveButton=document.getElementById("save");function prepareDownload(n,t){canvas||(canvas=document.createElement("canvas"));var a=canvas.getContext("2d"),e=new Image;e.onload=function(){canvas.width=this.width,canvas.height=this.height,a.drawImage(e,0,0),saveButton.download=n+".png";try{saveButton.href=canvas.toDataURL("image/png")}catch(n){saveButton.style.display="none"}},e.src=t.toDataUri()}var changeEvent=onChange($("#string"),(function(n){var t=GeoPattern.generate(n),a=next();$("#bg-"+a.next).css("background-image",t.toDataUrl()).stop().fadeIn(fadeOptions),$("#bg-"+a.prev).stop().fadeOut(fadeOptions),prepareDownload(n,t)}));$((function(){$("#string").val("  请键入内容  ").focus(),changeEvent.trigger()}));
